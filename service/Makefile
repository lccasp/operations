# Operations Service Makefile
# æä¾›å¸¸ç”¨çš„å¼€å‘å‘½ä»¤

.PHONY: help install dev test clean lint format init-db migrate

# é»˜è®¤ç›®æ ‡
help:
	@echo "Operations Service - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "  install     å®‰è£…ä¾èµ–"
	@echo "  dev         å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
	@echo "  test        è¿è¡Œæµ‹è¯•"
	@echo "  lint        ä»£ç æ£€æŸ¥"
	@echo "  format      ä»£ç æ ¼å¼åŒ–"
	@echo "  init-db     åˆå§‹åŒ–æ•°æ®åº“"
	@echo "  migrate     åˆ›å»ºæ•°æ®åº“è¿ç§»"
	@echo "  clean       æ¸…ç†ä¸´æ—¶æ–‡ä»¶"
	@echo ""

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
dev:
	@echo "ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
	python scripts/run_dev.py

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	python scripts/test.py

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” æ£€æŸ¥ä»£ç è´¨é‡..."
	flake8 app/ tests/
	mypy app/

# ä»£ç æ ¼å¼åŒ–
format:
	@echo "âœ¨ æ ¼å¼åŒ–ä»£ç ..."
	black app/ tests/ scripts/
	isort app/ tests/ scripts/

# åˆå§‹åŒ–æ•°æ®åº“
init-db:
	@echo "ğŸ—„ï¸ åˆå§‹åŒ–æ•°æ®åº“..."
	python scripts/init_db.py

# åˆ›å»ºæ•°æ®åº“è¿ç§»
migrate:
	@echo "ğŸ“ åˆ›å»ºæ•°æ®åº“è¿ç§»..."
	@read -p "è¾“å…¥è¿ç§»æè¿°: " desc; \
	alembic revision --autogenerate -m "$$desc"

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .pytest_cache/
	rm -rf htmlcov/
	rm -rf .coverage
	rm -rf dist/
	rm -rf build/
	rm -rf *.egg-info/
